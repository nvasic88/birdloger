(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{Fr13:function(t,e,n){"use strict";n.r(e);var o=n("3wZJ"),a=n("9KKN"),r=n("2qhe"),s=n("uuKk"),i=n("uTtz"),l=n("LNOP"),c=n("DgLj");function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){p(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t,e){if(null==t)return{};var n,o,a=function(t,e){if(null==t)return{};var n,o,a={},r=Object.keys(t);for(o=0;o<r.length;o++)n=r[o],e.indexOf(n)>=0||(a[n]=t[n]);return a}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(o=0;o<r.length;o++)n=r[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}var f={name:"nzTaxaTable",mixins:[o.a,a.a],components:{NzTaxonAutocomplete:s.a,NzPerPageSelect:i.a,NzSortableColumnHeader:l.a,NzExportModal:c.a},props:{perPageOptions:{type:Array,default:function(){return[15,30,50,100]},validator:function(t){return t.length}},listRoute:String,editRoute:String,deleteRoute:String,empty:{type:String,default:"Nothing here."},showActivityLog:Boolean,exportColumns:Array,exportUrl:String},data:function(){return{data:[],total:0,loading:!1,sortField:"spid",sortOrder:"asc",page:1,perPage:this.perPageOptions[0],checkedRows:[],activityLog:[],showExportModal:!1}},computed:{hasActions:function(){return this.exportable},exportable:function(){return!(!this.exportUrl||!this.exportColumns.length)},checkedIds:function(){return this.checkedRows.map((function(t){return t.id}))},sortBy:function(){return"".concat(this.sortField,".").concat(this.sortOrder)}},created:function(){var t=this;this.restoreState(),this.addMissingValuesAfterRestoration(),this.loadAsyncData(),this.$on("filter",(function(){t.page=1,t.saveState(),t.loadAsyncData()}))},methods:{loadAsyncData:function(){var t=this;this.loading=!0,this.checkedRows=[];var e=this.filter,n=(e.selectedTaxon,h(e,["selectedTaxon"]));return axios.get(route(this.listRoute).withQuery(d(d({},n),{},{sort_by:this.sortBy,page:this.page,per_page:this.perPage}))).then((function(e){var n=e.data;t.data=n.data,t.total=n.meta.total,t.loading=!1}),(function(e){t.data=[],t.total=0,t.loading=!1}))},onPageChange:function(t){this.page=t,this.saveState(),this.loadAsyncData()},onSort:function(t,e){this.sortField=t,this.sortOrder=e,this.saveState(),this.loadAsyncData()},onPerPageChange:function(t){t!==this.perPage&&(this.perPage=t,this.saveState(),this.loadAsyncData())},confirmRemove:function(t){var e=this;this.$buefy.dialog.confirm({message:this.trans("Are you sure you want to delete this record?"),confirmText:this.trans("buttons.delete"),cancelText:this.trans("buttons.cancel"),type:"is-danger",onConfirm:function(){e.remove(t)}})},remove:function(t){var e=this;return axios.delete(route(this.deleteRoute,t.id)).then((function(t){e.$buefy.toast.open({message:e.trans("Record deleted"),type:"is-success"}),e.loadAsyncData()})).catch((function(t){console.error(t)}))},editLink:function(t){return route(this.editRoute,t.id)},openActivityLogModal:function(t){this.activityLog=t.activity},filterDefaults:function(){return{name:null,rank:null,taxonId:null,includeChildTaxa:null,selectedTaxon:null,id:null}},openExportModal:function(){this.showExportModal=!0},onExportDone:function(t){this.showExportModal=!1,t.url?this.$buefy.modal.open({parent:this,component:r.a,canCancel:[],hasModalCard:!0,props:{url:t.url}}):this.$buefy.toast.open({duration:0,message:"Something's not good, also I'm on bottom",type:"is-danger"})},onTaxonSelect:function(t){this.newFilter.taxonId=t?t.id:null,this.newFilter.selectedTaxon=t},getPersistantKeys:function(){return["sortField","sortOrder","perPage","page","newFilter","filter","filterIsActive"]},addMissingValuesAfterRestoration:function(){this.page=this.page||1,this.perPage=this.perPage||this.perPageOptions[0],this.sortField=this.sortField||"id",this.sortOrder=this.sortOrder||"desc"}}},v=n("KHd+"),g=Object(v.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"taxa-table"},[n("div",{staticClass:"level"},[n("div",{staticClass:"level-left"},[n("div",{staticClass:"level-item"},[n("button",{staticClass:"button is-touch-full",attrs:{type:"button"},on:{click:function(e){t.showFilter=!t.showFilter}}},[n("b-icon",{class:[t.filterIsActive?"has-text-primary":"has-text-grey-light"],attrs:{icon:"filter"}}),t._v(" "),n("span",[t._v(t._s(t.trans("buttons.filters")))])],1)])]),t._v(" "),t.hasActions?n("div",{staticClass:"level-right"},[n("div",{staticClass:"level-item"},[n("b-dropdown",{attrs:{position:"is-bottom-left"}},[n("button",{staticClass:"button is-touch-full",attrs:{slot:"trigger"},slot:"trigger"},[n("span",[t._v(t._s(t.trans("labels.actions")))]),t._v(" "),n("span",{staticClass:"icon has-text-grey"},[n("i",{staticClass:"fa fa-angle-down"})])]),t._v(" "),t.exportable?n("b-dropdown-item",{on:{click:t.openExportModal}},[n("b-icon",{staticClass:"has-text-grey",attrs:{icon:"download"}}),t._v(" "),n("span",[t._v(t._s(t.trans("buttons.export")))])],1):t._e()],1)],1)]):t._e()]),t._v(" "),n("b-collapse",{staticClass:"mt-4",attrs:{open:t.showFilter}},[n("form",{on:{submit:function(e){return e.preventDefault(),t.applyFilter(e)}}},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column is half"},[n("nz-taxon-autocomplete",{attrs:{taxon:t.newFilter.selectedTaxon,label:t.trans("labels.taxa.name"),placeholder:""},on:{select:t.onTaxonSelect},model:{value:t.newFilter.name,callback:function(e){t.$set(t.newFilter,"name",e)},expression:"newFilter.name"}})],1)]),t._v(" "),n("button",{staticClass:"button is-primary is-outlined",attrs:{type:"submit"},on:{click:t.applyFilter}},[t._v(t._s(t.trans("buttons.apply")))]),t._v(" "),n("button",{staticClass:"button",attrs:{type:"button"},on:{click:t.clearFilter}},[t._v(t._s(t.trans("buttons.clear")))])])]),t._v(" "),n("hr"),t._v(" "),n("b-table",{attrs:{data:t.data,loading:t.loading,paginated:"","backend-pagination":"",total:t.total,"per-page":t.perPage,"current-page":t.page,"pagination-position":"both","backend-sorting":"","default-sort-direction":"asc","default-sort":[t.sortField,t.sortOrder],"mobile-cards":"",checkable:t.hasActions,"checked-rows":t.checkedRows},on:{"page-change":t.onPageChange,sort:t.onSort,"update:checkedRows":function(e){t.checkedRows=e},"update:checked-rows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"top-left",fn:function(){return[n("nz-per-page-select",{attrs:{value:t.perPage,options:t.perPageOptions},on:{input:t.onPerPageChange}})]},proxy:!0},{key:"bottom-left",fn:function(){return[n("nz-per-page-select",{attrs:{value:t.perPage,options:t.perPageOptions},on:{input:t.onPerPageChange}})]},proxy:!0},{key:"empty",fn:function(){return[n("section",{staticClass:"section"},[n("div",{staticClass:"content has-text-grey has-text-centered"},[n("p",[t._v(t._s(t.empty))])])])]},proxy:!0}])},[t._v(" "),t._v(" "),n("b-table-column",{attrs:{field:"id",label:t.trans("labels.id"),width:"40",numeric:"",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v("\n        "+t._s(n.id)+"\n      ")]}},{key:"header",fn:function(e){var o=e.column;return[n("nz-sortable-column-header",{attrs:{column:o,sort:{field:t.sortField,order:t.sortOrder}}})]}}])}),t._v(" "),n("b-table-column",{attrs:{field:"spid",label:t.trans("labels.taxa.spid"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v("\n        "+t._s(n.spid)+"\n      ")]}},{key:"header",fn:function(e){var o=e.column;return[n("nz-sortable-column-header",{attrs:{column:o,sort:{field:t.sortField,order:t.sortOrder}}})]}}])}),t._v(" "),n("b-table-column",{attrs:{field:"type",label:t.trans("labels.taxa.type"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v("\n        "+t._s(n.type)+"\n      ")]}},{key:"header",fn:function(e){var o=e.column;return[n("nz-sortable-column-header",{attrs:{column:o,sort:{field:t.sortField,order:t.sortOrder}}})]}}])}),t._v(" "),n("b-table-column",{attrs:{field:"name",label:t.trans("labels.taxa.name"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v("\n        "+t._s(n.name+(n.native_name?" ("+n.native_name+")":""))+"\n      ")]}},{key:"header",fn:function(e){var o=e.column;return[n("nz-sortable-column-header",{attrs:{column:o,sort:{field:t.sortField,order:t.sortOrder}}})]}}])}),t._v(" "),n("b-table-column",{attrs:{width:"150",numeric:""},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[t.showActivityLog&&o.activity&&o.activity.length>0?n("a",{attrs:{title:t.trans("Activity Log")},on:{click:function(e){return t.openActivityLogModal(o)}}},[n("b-icon",{attrs:{icon:"history"}})],1):t._e(),t._v(" "),o.can_edit?n("a",{attrs:{href:t.editLink(o)}},[n("b-icon",{attrs:{icon:"edit"}})],1):t._e(),t._v(" "),o.can_delete?n("a",{on:{click:function(e){return t.confirmRemove(o)}}},[n("b-icon",{attrs:{icon:"trash"}})],1):t._e()]}}])})],1),t._v(" "),n("b-modal",{attrs:{active:t.activityLog.length>0,"has-modal-card":""},on:{close:function(e){t.activityLog=[]}}},[n("div",{staticClass:"modal-card"},[n("div",{staticClass:"modal-card-head"},[n("b-icon",{attrs:{icon:"history"}}),t._v(" "),n("p",{staticClass:"modal-card-title"},[t._v(t._s(t.trans("Activity Log")))])],1),t._v(" "),n("div",{staticClass:"modal-card-body"},[n("nz-taxon-activity-log",{attrs:{activities:t.activityLog}})],1)])]),t._v(" "),n("b-modal",{attrs:{active:t.showExportModal,"has-modal-card":"","can-cancel":[]},on:{close:function(e){t.showExportModal=!1}}},[n("nz-export-modal",{attrs:{checked:t.checkedIds,filter:t.filter,columns:t.exportColumns,url:t.exportUrl,types:["custom"],sort:t.sortBy},on:{cancel:function(e){t.showExportModal=!1},done:t.onExportDone}})],1)],1)}),[],!1,null,null,null);e.default=g.exports}}]);
//# sourceMappingURL=38.js.map?id=49aa6860695322a23c8c
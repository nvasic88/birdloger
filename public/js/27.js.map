{"version":3,"sources":["webpack:///./resources/js/mixins/FormMixin.js","webpack:///./resources/js/components/inputs/PhotoUpload.vue?b649","webpack:///./resources/js/Croppr.js","webpack:///./resources/js/components/ImageCropModal.vue?7cdd","webpack:///resources/js/components/ImageCropModal.vue","webpack:///./resources/js/components/inputs/PhotoUpload.vue?7763","webpack:///resources/js/components/inputs/PhotoUpload.vue","webpack:///./resources/js/components/ImageCropModal.vue","webpack:///./resources/js/components/ImageCropModal.vue?9faf","webpack:///./resources/js/components/inputs/PhotoUpload.vue","webpack:///./resources/js/components/ImageModal.vue?e923","webpack:///./resources/js/components/ImageModal.vue?a0e2","webpack:///resources/js/components/ImageModal.vue","webpack:///./resources/js/components/ImageModal.vue","webpack:///./resources/js/components/forms/ViewGroupForm.vue?8809","webpack:///resources/js/components/forms/ViewGroupForm.vue","webpack:///./resources/js/components/forms/ViewGroupForm.vue?4af1","webpack:///./resources/js/components/forms/ViewGroupForm.vue"],"names":["name","props","action","type","String","required","method","default","redirectUrl","cancelUrl","submitMore","Boolean","shouldConfirmSubmit","confirmSubmitMessage","this","trans","shouldAskReason","shouldConfirmCancel","submitOnlyDirty","submitOnlyDirtyMessage","data","form","newForm","keepAfterSubmit","submittingWithRedirect","submittingWithoutRedirect","confirmingSubmit","confirmingCancel","locale","window","App","created","document","addEventListener","registerKeyListener","beforeDestroy","removeEventListener","methods","Form","resetOnSuccess","e","enter","which","keyCode","ctrlKey","shiftKey","submitWithoutRedirect","submitWithRedirect","confirmSubmit","onConfirm","options","message","confirmText","cancelText","onCancel","promptForReason","$buefy","dialog","confirm","prompt","inputAttrs","placeholder","maxlength","$nextTick","$refs","input","target","setCustomValidity","validity","valid","validationMessage","notifyNoChanges","toast","open","notifyNoChangesAndRedirect","setTimeout","location","href","processing","isDirty","performSubmitWithRedirect","reason","toLowerCase","then","onSuccessfulSubmitWithRedirect","onFailedSubmit","hookAfterSubmitWithRedirect","performSubmitWithoutRedirect","onSuccessfulSubmitWithoutRedirect","keep","_pick","reset","populate","hookAfterSubmitWithoutRedirect","error","duration","_get","_isEqual","initial","confirmCancel","event","preventDefault","Croppr","value","actualWidth","imageEl","naturalWidth","actualHeight","naturalHeight","factorX","offsetWidth","factorY","offsetHeight","box","Box","Math","round","x","y","width","height","redraw","BaseCroppr","mixins","canCancel","Array","imageUrl","crop","Object","newCrop","preserveRatio","mounted","ctrlIsPressed","ctrlIsNotPressed","watch","isActive","handleScroll","croppr","onCropEnd","onInitialize","setBoxToRealPosition","savedScrollTop","body","classList","toggle","style","top","documentElement","scrollTop","cropImage","$emit","close","aspectRatio","components","NzImageCropModal","_vm","_h","$createElement","_c","_self","attrs","animation","staticClass","_v","maxWidth","newWidth","ref","on","$event","cancel","_e","NzImageModal","withCrop","uploading","loading","headers","getImageDataUrl","canvas","createElement","setAttribute","img","getContext","drawImage","toDataURL","haveImage","showModal","thumbnailUrl","openCropModal","closeCropModal","image","path","hasExisting","remove","license","handleLicenseChanged","domProps","_s","_l","label","key","showCropModal","url","$set","onInput","progress","text","items","Number","newValue","active","computed","openImage","handler","next","length","prev","onClose","component","defaultTranslations","FormMixin","NzPhotoUpload","group","rootGroups","names","descriptions","taxa","filteredTaxa","supportedLocales","parent","get","set","parent_id","isRoot","taxa_ids","map","description","image_url","image_path","only_observed_taxa","focusOnTranslation","fetchTaxa","axios","route","params","page","per_page","except","onTaxonNameInput","onImageUploaded","onImageRemoved","model","callback","$$v","expression","rootGroup","index","scopedSlots","_u","fn","option","class"],"mappings":"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","file":"js/27.js?id=12a67162a224f73d0065","sourcesContent":["import Form from 'form-backend-validation'\r\nimport _pick from 'lodash/pick'\r\nimport _get from 'lodash/get'\r\nimport _isEqual from 'lodash/isEqual'\r\n\r\n\r\nexport default {\r\n  name: 'nzFieldObservationForm',\r\n\r\n  props: {\r\n    action: {\r\n      type: String,\r\n      required: true\r\n    },\r\n\r\n    method: {\r\n      type: String,\r\n      default: 'POST'\r\n    },\r\n\r\n    redirectUrl: String,\r\n    cancelUrl: String,\r\n\r\n    submitMore: Boolean,\r\n    shouldConfirmSubmit: Boolean,\r\n    confirmSubmitMessage: {\r\n      type: String,\r\n      default() {\r\n        return this.trans('You are about to submit')\r\n      }\r\n    },\r\n    shouldAskReason: Boolean,\r\n    shouldConfirmCancel: Boolean,\r\n    submitOnlyDirty: Boolean,\r\n    submitOnlyDirtyMessage: {\r\n      type: String,\r\n      default() {\r\n        return this.trans('There are no changes, the data will not be saved.')\r\n      }\r\n    }\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      form: this.newForm(),\r\n      keepAfterSubmit: [],\r\n      submittingWithRedirect: false,\r\n      submittingWithoutRedirect: false,\r\n      confirmingSubmit: false,\r\n      confirmingCancel: false,\r\n      locale: window.App.locale\r\n    }\r\n  },\r\n\r\n  created() {\r\n    document.addEventListener('keyup', this.registerKeyListener)\r\n  },\r\n\r\n  beforeDestroy() {\r\n    document.removeEventListener('keyup', this.registerKeyListener)\r\n  },\r\n\r\n  methods: {\r\n    /**\r\n     * Create new form instance.\r\n     *\r\n     * @param  {Object} data default form data\r\n     * @return {Form}\r\n     */\r\n    newForm(data = {}) {\r\n      return new Form(data, {\r\n        resetOnSuccess: false\r\n      })\r\n    },\r\n\r\n    /**\r\n     * Keyboard shortcuts.\r\n     *\r\n     * @param {Event} e\r\n     */\r\n    registerKeyListener(e) {\r\n      const enter = 13 === (e.which || e.keyCode)\r\n\r\n      if (e.ctrlKey && e.shiftKey && enter) {\r\n        this.submitMore && this.submitWithoutRedirect()\r\n      } else if (e.ctrlKey && enter) {\r\n        this.submitWithRedirect()\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Confirm submit.\r\n     *\r\n     * @param {Function} onConfirm\r\n     */\r\n    confirmSubmit(onConfirm) {\r\n      if (this.confirmingSubmit) return\r\n\r\n      this.confirmingSubmit = true\r\n\r\n      const options = {\r\n        message: this.confirmSubmitMessage,\r\n        confirmText: this.trans('buttons.save'),\r\n        cancelText: this.trans('buttons.cancel'),\r\n        onConfirm,\r\n        onCancel: () => { this.confirmingSubmit = false }\r\n      }\r\n\r\n      if (!this.shouldAskReason) {\r\n        return this.$buefy.dialog.confirm(options)\r\n      }\r\n\r\n      return this.promptForReason(options)\r\n    },\r\n\r\n    /**\r\n     * Prompt the user for reason of change.\r\n     *\r\n     * @param  {Object} options\r\n     * @return {Vue}\r\n     */\r\n    promptForReason(options) {\r\n      const dialog = this.$buefy.dialog.prompt({\r\n        ...options,\r\n        inputAttrs: {\r\n            placeholder: this.trans('Reason'),\r\n            required: true,\r\n            maxlength: 255\r\n        }\r\n      })\r\n\r\n      // Custom localized validation for the prompt input.\r\n      dialog.$nextTick(() => {\r\n        dialog.$refs.input.addEventListener('invalid', (e) => {\r\n          e.target.setCustomValidity('')\r\n\r\n          if (!e.target.validity.valid) {\r\n            e.target.setCustomValidity(this.trans('This field is required and can contain max 255 chars.'))\r\n          }\r\n        })\r\n\r\n        dialog.$refs.input.addEventListener('input', (e) => {\r\n          dialog.validationMessage = null\r\n        })\r\n      })\r\n\r\n      return dialog\r\n    },\r\n\r\n    /**\r\n     * Notify the user there are no changes.\r\n     */\r\n    notifyNoChanges() {\r\n      this.$buefy.toast.open({\r\n        message: this.submitOnlyDirtyMessage,\r\n        type: 'is-info'\r\n      })\r\n    },\r\n\r\n    /**\r\n     * Notify the user there are no changes and redirect.\r\n     */\r\n    notifyNoChangesAndRedirect() {\r\n      this.notifyNoChanges()\r\n\r\n      setTimeout(() => {\r\n        if (this.redirectUrl) {\r\n          window.location.href = this.redirectUrl\r\n        }\r\n      }, 500)\r\n    },\r\n\r\n    /**\r\n     * Submit the form with redirect.\r\n     */\r\n    submitWithRedirect() {\r\n      if (this.form.processing) return\r\n\r\n      if (this.submitOnlyDirty && !this.isDirty()) return this.notifyNoChangesAndRedirect()\r\n\r\n      if (this.shouldConfirmSubmit) return this.confirmSubmit(this.performSubmitWithRedirect)\r\n\r\n      this.performSubmitWithRedirect()\r\n    },\r\n\r\n    /**\r\n     * Submit the form with redirect.\r\n     */\r\n    performSubmitWithRedirect(reason = null) {\r\n      this.submittingWithRedirect = true\r\n      this.confirmingSubmit = false\r\n\r\n      if (this.shouldAskReason) {\r\n        this.form.reason = reason\r\n      }\r\n\r\n      this.form[this.method.toLowerCase()](this.action)\r\n          .then(this.onSuccessfulSubmitWithRedirect)\r\n          .catch(this.onFailedSubmit)\r\n    },\r\n\r\n    /**\r\n     * Handle successful form submit with redirect.\r\n     */\r\n    onSuccessfulSubmitWithRedirect() {\r\n      this.form.processing = true\r\n\r\n      this.$buefy.toast.open({\r\n        message: this.trans('Saved successfully'),\r\n        type: 'is-success'\r\n      })\r\n\r\n      // We want to wait a bit before we send the user to redirect route\r\n      // so we can show the message that the action was successful.\r\n      setTimeout(() => {\r\n        this.form.processing = false\r\n        this.submittingWithRedirect = false\r\n\r\n        this.hookAfterSubmitWithRedirect()\r\n\r\n        if (this.redirectUrl) {\r\n          window.location.href = this.redirectUrl\r\n        }\r\n      }, 500)\r\n    },\r\n\r\n    /**\r\n     * Perform after submit with redirect is successful.\r\n     */\r\n    hookAfterSubmitWithRedirect() {},\r\n\r\n    /**\r\n     * Submit the form and stay to add more.\r\n     */\r\n    submitWithoutRedirect() {\r\n      if (this.form.processing) return\r\n\r\n      if (this.submitOnlyDirty  && !this.isDirty()) return this.notifyNoChanges()\r\n\r\n      if (this.shouldConfirmSubmit) return this.confirmSubmit(this.performSubmitWithoutRedirect)\r\n\r\n      this.performSubmitWithoutRedirect()\r\n    },\r\n\r\n    /**\r\n     * Submit the form and stay to add more.\r\n     */\r\n    performSubmitWithoutRedirect(reason = null) {\r\n      this.submittingWithoutRedirect = true\r\n      this.confirmingSubmit = false\r\n\r\n      if (this.shouldAskReason) {\r\n        this.form.reason = reason\r\n      }\r\n\r\n      this.form[this.method.toLowerCase()](this.action)\r\n          .then(this.onSuccessfulSubmitWithoutRedirect)\r\n          .catch(this.onFailedSubmit)\r\n    },\r\n\r\n    /**\r\n     * Handle successful form submit with no redirect.\r\n     */\r\n    onSuccessfulSubmitWithoutRedirect() {\r\n      this.submittingWithoutRedirect = false\r\n\r\n      this.$buefy.toast.open({\r\n        message: this.trans('Saved successfully'),\r\n        type: 'is-success'\r\n      })\r\n\r\n      // Reset the form but remember some data.\r\n      const keep = _pick(this.form.data(), this.keepAfterSubmit)\r\n      this.form.reset()\r\n      this.form.populate(keep)\r\n\r\n      this.hookAfterSubmitWithoutRedirect()\r\n    },\r\n\r\n    /**\r\n     * Perform after submit without redirect is successful.\r\n     */\r\n    hookAfterSubmitWithoutRedirect() {},\r\n\r\n    /**\r\n     * Handle failed form submit.\r\n     *\r\n     * @param {Error} error\r\n     */\r\n    onFailedSubmit(error) {\r\n      this.submittingWithRedirect = false\r\n      this.submittingWithoutRedirect = false\r\n\r\n      this.$buefy.toast.open({\r\n        duration: 2500,\r\n        message: _get(error, 'response.data.message', error.message),\r\n        type: 'is-danger'\r\n      })\r\n    },\r\n\r\n    /**\r\n     * Check if form is changed.\r\n     *\r\n     * @return {Boolean}\r\n     */\r\n    isDirty() {\r\n      return ! _isEqual(this.form.data(), this.form.initial)\r\n    },\r\n\r\n    /**\r\n     * Confirmation dialog for canceling.\r\n     */\r\n    confirmCancel() {\r\n      if (this.confirmingCancel) return\r\n\r\n      this.confirmingCancel = true\r\n\r\n      this.$buefy.dialog.confirm({\r\n        message: this.trans('If you leave this page changes will not be saved.'),\r\n        onConfirm: () => {\r\n          this.confirmingCancel = false\r\n          window.location.href = this.cancelUrl\r\n        },\r\n        onCancel: () => { this.confirmingCancel = false },\r\n        cancelText: this.trans('buttons.stay_on_page'),\r\n        confirmText: this.trans('buttons.leave_page'),\r\n      })\r\n    },\r\n\r\n    /**\r\n     * Handle cancel button/link.\r\n     *\r\n     * @param {Event} event\r\n     */\r\n    onCancel(event) {\r\n      if (this.shouldConfirmCancel && this.isDirty()) {\r\n        event.preventDefault()\r\n\r\n        this.confirmCancel()\r\n      }\r\n    }\r\n  }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (!_vm.haveImage)?_c('b-field',{attrs:{\"message\":_vm.error || null,\"type\":_vm.error ? 'is-danger' : null,\"expanded\":\"\"}},[_c('b-upload',{attrs:{\"drag-drop\":\"\",\"expanded\":\"\",\"disabled\":_vm.uploading || _vm.loading},on:{\"input\":_vm.onInput}},[_c('section',{ref:\"uploadZone\",staticClass:\"section is-relative\"},[_c('div',{staticClass:\"has-text-centered\"},[_c('div',[_c('b-icon',{attrs:{\"icon\":\"upload\",\"size\":\"is-medium\"}})],1),_vm._v(\" \"),(_vm.uploading)?_c('progress',{staticClass:\"progress is-primary is-small\",attrs:{\"max\":\"100\"},domProps:{\"value\":_vm.progress}},[_vm._v(_vm._s(_vm.progress)+\"%\")]):(_vm.loading)?_c('div',[_vm._v(_vm._s(_vm.trans('Loading...')))]):_c('div',[_vm._v(_vm._s(_vm.text))])])])])],1):_c('div',{staticClass:\"card\"},[_c('div',{staticClass:\"card-image\"},[_c('figure',{staticClass:\"has-magnifier has-text-centered\",on:{\"click\":function($event){_vm.showModal = true}}},[_c('img',{staticClass:\"max-h-36\",attrs:{\"src\":_vm.thumbnailUrl,\"alt\":\"Uploaded photo\"}}),_vm._v(\" \"),_c('div',{staticClass:\"image-magnifier\"},[_c('b-icon',{attrs:{\"icon\":\"expand\",\"size\":\"is-medium\"}})],1)])]),_vm._v(\" \"),(_vm.haveImage)?_c('footer',{staticClass:\"card-footer\"},[_c('div',{staticClass:\"card-footer-item flex-col\"},[_c('div',{staticClass:\"mb-4 w-full flex justify-between\"},[(_vm.withCrop)?_c('button',{staticClass:\"button is-outlined is-small mr-2\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.openCropModal,\"close\":_vm.closeCropModal}},[_c('b-icon',{attrs:{\"icon\":\"crop\"}})],1):_vm._e(),_vm._v(\" \"),(_vm.image.path || _vm.hasExisting)?_c('button',{staticClass:\"delete is-danger is-medium\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.remove}}):_vm._e()]),_vm._v(\" \"),(_vm.withLicense)?_c('div',{staticClass:\"w-full\"},[_c('b-select',{attrs:{\"value\":_vm.image.license,\"expanded\":\"\"},on:{\"input\":_vm.handleLicenseChanged}},[_c('option',{domProps:{\"value\":null}},[_vm._v(_vm._s(_vm.trans('labels.field_observations.default')))]),_vm._v(\" \"),_vm._l((_vm.licenses),function(label,value){return _c('option',{key:value,domProps:{\"value\":value,\"textContent\":_vm._s(label)}})})],2)],1):_vm._e()])]):_vm._e(),_vm._v(\" \"),(_vm.haveImage)?_c('nz-image-crop-modal',{attrs:{\"active\":_vm.showCropModal,\"crop\":_vm.image.crop,\"image-url\":_vm.image.url},on:{\"update:active\":function($event){_vm.showCropModal=$event},\"update:crop\":function($event){return _vm.$set(_vm.image, \"crop\", $event)}}}):_vm._e(),_vm._v(\" \"),(_vm.showModal)?_c('nz-image-modal',{attrs:{\"items\":[_vm.thumbnailUrl]},on:{\"close\":function($event){_vm.showModal = false}}}):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import BaseCroppr from 'croppr'\r\nimport Box from 'croppr/src/box'\r\n\r\nexport default class Croppr extends BaseCroppr {\r\n  setBoxToRealPosition(value) {\r\n    const actualWidth = this.imageEl.naturalWidth\r\n    const actualHeight = this.imageEl.naturalHeight\r\n    const factorX = actualWidth / this.imageEl.offsetWidth\r\n    const factorY = actualHeight / this.imageEl.offsetHeight\r\n\r\n    this.box = new Box(\r\n      Math.round(value.x / factorX),\r\n      Math.round(value.y / factorY),\r\n      Math.round((value.x + value.width) / factorX),\r\n      Math.round((value.y + value.height) / factorY)\r\n    )\r\n\r\n    this.redraw()\r\n  }\r\n}\r\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ImageCropModal.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ImageCropModal.vue?vue&type=script&lang=js&\"","<template>\r\n  <transition :name=\"animation\">\r\n    <div v-if=\"isActive\" class=\"modal is-active\">\r\n      <div class=\"modal-background\"/>\r\n\r\n      <div\r\n        class=\"animation-content modal-content\"\r\n        :style=\"{ maxWidth: newWidth }\"\r\n      >\r\n        <img\r\n          :src=\"imageUrl\"\r\n          class=\"image\"\r\n          alt=\"Cropped image\"\r\n          ref=\"cropModalImage\"\r\n        >\r\n      </div>\r\n\r\n      <button\r\n        type=\"button\"\r\n        class=\"modal-close is-large\"\r\n        @click=\"cancel('x')\"\r\n      />\r\n\r\n      <button\r\n        type=\"button\"\r\n        class=\"modal-action\"\r\n        @click=\"cropImage\"\r\n      >\r\n        <b-icon icon=\"check\"/>\r\n      </button>\r\n    </div>\r\n  </transition>\r\n</template>\r\n\r\n<script>\r\nimport Croppr from '@/Croppr'\r\nimport bModal from 'buefy/src/components/modal/Modal'\r\n\r\nexport default {\r\n  name: 'nzImageCropModal',\r\n\r\n  mixins: [bModal],\r\n\r\n  props: {\r\n    canCancel: {\r\n      type: [Array, Boolean],\r\n      default: () => ['escape', 'x']\r\n    },\r\n    imageUrl: String,\r\n    crop: Object\r\n  },\r\n\r\n  data() {\r\n    return {\r\n\t\t\tcroppr: null,\r\n      newCrop: this.crop,\r\n      preserveRatio: false\r\n    }\r\n  },\r\n\r\n  mounted() {\r\n    document.addEventListener('keydown', this.ctrlIsPressed)\r\n    document.addEventListener('keyup', this.ctrlIsNotPressed)\r\n  },\r\n\r\n  beforeDestroy() {\r\n    document.removeEventListener('keydown', this.ctrlIsPressed)\r\n    document.removeEventListener('keyup', this.ctrlIsNotPressed)\r\n  },\r\n\r\n  watch: {\r\n    isActive(value) {\r\n      this.handleScroll()\r\n\r\n      this.croppr =  null\r\n\r\n      if (value) {\r\n        this.$nextTick(() => {\r\n          this.croppr = new Croppr(this.$refs.cropModalImage, {\r\n            onCropEnd: (value) => {\r\n              this.newCrop = value\r\n            },\r\n\r\n            onInitialize: (croppr) => {\r\n              if (this.newCrop) {\r\n                croppr.setBoxToRealPosition(this.newCrop)\r\n              }\r\n            }\r\n          })\r\n        })\r\n      }\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    handleScroll() {\r\n      if (typeof window === 'undefined') return\r\n\r\n      this.savedScrollTop = !this.savedScrollTop\r\n        ? document.documentElement.scrollTop\r\n        : this.savedScrollTop\r\n\r\n      document.body.classList.toggle('is-noscroll', this.isActive)\r\n\r\n      if (this.isActive) {\r\n        document.body.style.top = `-${this.savedScrollTop}px`\r\n        return\r\n      }\r\n\r\n      document.documentElement.scrollTop = this.savedScrollTop\r\n      document.body.style.top = null\r\n      this.savedScrollTop = null\r\n    },\r\n\r\n    cropImage() {\r\n      this.$emit('update:crop', this.newCrop)\r\n\r\n      this.close()\r\n    },\r\n\r\n    ctrlIsPressed(e) {\r\n      if (e.which == 17 && this.croppr) {\r\n        this.croppr.options.aspectRatio = this.croppr.box.height() / this.croppr.box.width()\r\n      }\r\n    },\r\n\r\n    ctrlIsNotPressed(e) {\r\n      if (e.which == 17  && this.croppr) {\r\n        this.croppr.options.aspectRatio = null\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PhotoUpload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PhotoUpload.vue?vue&type=script&lang=js&\"","<template>\r\n\t<b-field v-if=\"!haveImage\" :message=\"error || null\" :type=\"error ? 'is-danger' : null\" expanded>\r\n\t\t<b-upload @input=\"onInput\" drag-drop expanded :disabled=\"uploading || loading\">\r\n\t\t\t<section class=\"section is-relative\" ref=\"uploadZone\">\r\n\t\t\t\t<div class=\"has-text-centered\">\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<b-icon\r\n\t\t\t\t\t\t\ticon=\"upload\"\r\n\t\t\t\t\t\t\tsize=\"is-medium\">\r\n\t\t\t\t\t\t</b-icon>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<progress class=\"progress is-primary is-small\" :value=\"progress\" max=\"100\" v-if=\"uploading\">{{ progress }}%</progress>\r\n\r\n          <div v-else-if=\"loading\">{{ trans('Loading...') }}</div>\r\n\r\n\t\t\t\t\t<div v-else>{{ text }}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</section>\r\n\t\t</b-upload>\r\n\t</b-field>\r\n\r\n\t<div class=\"card\" v-else>\r\n\t\t<div class=\"card-image\">\r\n\t\t\t<figure class=\"has-magnifier has-text-centered\" @click=\"showModal = true\">\r\n        <img :src=\"thumbnailUrl\" alt=\"Uploaded photo\" class=\"max-h-36\" />\r\n        <div class=\"image-magnifier\">\r\n          <b-icon icon=\"expand\" size=\"is-medium\" />\r\n        </div>\r\n\t\t\t</figure>\r\n\t  </div>\r\n\r\n\t\t<footer class=\"card-footer\" v-if=\"haveImage\">\r\n\t\t\t<div class=\"card-footer-item flex-col\">\r\n\t\t\t\t<div class=\"mb-4 w-full flex justify-between\">\r\n\t\t\t\t\t<button\r\n            type=\"button\"\r\n            class=\"button is-outlined is-small mr-2\"\r\n            v-if=\"withCrop\"\r\n            @click=\"openCropModal\"\r\n            @close=\"closeCropModal\"\r\n          >\r\n            <b-icon icon=\"crop\" />\r\n          </button>\r\n\r\n\t\t\t\t\t<button type=\"button\" class=\"delete is-danger is-medium\" @click=\"remove\" v-if=\"image.path || hasExisting\"></button>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"w-full\" v-if=\"withLicense\">\r\n\t\t\t\t\t<b-select :value=\"image.license\" @input=\"handleLicenseChanged\" expanded>\r\n\t\t\t\t\t\t<option :value=\"null\">{{ trans('labels.field_observations.default') }}</option>\r\n\t\t\t\t\t\t<option v-for=\"(label, value) in licenses\" :value=\"value\" :key=\"value\" v-text=\"label\"></option>\r\n\t\t\t\t\t</b-select>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</footer>\r\n\r\n\t\t<nz-image-crop-modal :active.sync=\"showCropModal\" :crop.sync=\"image.crop\" :image-url=\"image.url\" v-if=\"haveImage\"/>\r\n\r\n\t\t<nz-image-modal :items=\"[thumbnailUrl]\" v-if=\"showModal\" @close=\"showModal = false\"/>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport loadImage from 'blueimp-load-image'\r\nimport NzImageCropModal from '@/components/ImageCropModal'\r\nimport NzImageModal from '@/components/ImageModal'\r\n\r\nexport default {\r\n\tname: 'nzPhotoUpload',\r\n\r\n  components: {\r\n    NzImageCropModal,\r\n    NzImageModal\r\n  },\r\n\r\n  props: {\r\n\t\timageUrl: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: null\r\n\t\t},\r\n\t\timagePath: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: null\r\n\t\t},\r\n\t\timageLicense: {\r\n\t\t\ttype: [Number, String],\r\n\t\t\tdefault: null\r\n\t\t},\r\n\t\tlicenses: {\r\n\t\t\ttype: Object,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\ttext: String,\r\n\t\twithLicense: {\r\n      type: Boolean,\r\n      default: true\r\n    },\r\n    withCrop: {\r\n      type: Boolean,\r\n      default: true\r\n    }\r\n\t},\r\n\r\n  data() {\r\n    return {\r\n    \timage: {\r\n\t\t\t\turl: this.imageUrl,\r\n\t\t\t\tpath: this.imagePath,\r\n\t\t\t\tcrop: null,\r\n\t\t\t\tlicense: this.imageLicense\r\n\t\t\t},\r\n\t\t\tcroppedImageUrl: null,\r\n\t\t\treader: null,\r\n      uploading: false,\r\n      loading: false,\r\n\t\t\tprogress: 0,\r\n\t\t\thasExisting: !!this.imageUrl,\r\n\t\t\terror: null,\r\n\t\t\tshowCropModal: false,\r\n\t\t\tshowModal: false\r\n    }\r\n  },\r\n\r\n\twatch: {\r\n\t\t'image.crop': function (value) {\r\n\t\t\tthis.$emit('cropped', this.image)\r\n\r\n\t\t\tif (!value) {\r\n\t\t\t\tthis.croppedImageUrl = null\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tthis.cropThumbnail(value)\r\n    }\r\n\t},\r\n\r\n\tcomputed: {\r\n\t\thaveImage() {\r\n\t\t\treturn !!this.image.url\r\n\t\t},\r\n\r\n\t\tthumbnailUrl() {\r\n\t\t\treturn this.croppedImageUrl || this.image.url\r\n\t\t}\r\n\t},\r\n\r\n\tmethods: {\r\n\t\tselectImage() {\r\n\t\t\tthis.$refs.input.click()\r\n\t\t},\r\n\r\n\t\tonInput(file) {\r\n\t\t\tthis.error = null\r\n\r\n\t\t\tif (!file) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tthis.upload(file)\r\n\t\t},\r\n\r\n\t\tupload(file) {\r\n      this.uploading = true\r\n\t\t\treturn axios.post(route('api.photo-uploads.store'), this.makeForm(file), {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data',\r\n\t\t\t\t\tAccept: 'application/json'\r\n\t\t\t\t},\r\n\t\t\t\tonUploadProgress: progressEvent => {\r\n          this.progress = Math.floor((progressEvent.loaded * 100) / progressEvent.total)\r\n\t\t\t\t}\r\n\t\t\t}).then(response => {\r\n        this.image.path = response.data.file\r\n\t\t\t\tthis.image.exif = response.data.exif\r\n\t\t\t\tthis.image.license = null\r\n\t\t\t\tthis.uploading = false\r\n\t\t\t\tthis.progress = 0\r\n\r\n        this.$emit('uploaded', this.image)\r\n\r\n        this.loading = true\r\n\r\n        loadImage(file, img => {\r\n            this.image.url = this.getImageDataUrl(img)\r\n            this.loading = false\r\n        }, { orientation: true })\r\n\t\t\t}).catch(this.handleError)\r\n    },\r\n\r\n    getImageDataUrl(img) {\r\n      let canvas = img\r\n\r\n      if (! (canvas instanceof HTMLCanvasElement)) {\r\n        canvas = document.createElement('canvas')\r\n        canvas.setAttribute('width', img.width)\r\n        canvas.setAttribute('height', img.height)\r\n        canvas.getContext('2d').drawImage(img, 0, 0)\r\n      }\r\n\r\n      return canvas.toDataURL()\r\n    },\r\n\r\n\t\tmakeForm(file) {\r\n\t\t\tlet form = new FormData()\r\n\r\n\t\t\tform.append('file', file)\r\n\r\n\t\t\treturn form\r\n\t\t},\r\n\r\n\t\tremove() {\r\n\t\t\tif (this.hasExisting) {\r\n\t\t\t\tthis.hasExisting = false\r\n\t\t\t\treturn this.clearPhoto()\r\n\t\t\t}\r\n\r\n\t\t\taxios.delete(route('api.photo-uploads.destroy', this.image.path)).then(() => {\r\n\t\t\t\tthis.clearPhoto()\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\tclearPhoto() {\r\n\t\t\tthis.$emit('removed', this.image)\r\n\r\n\t\t\tthis.image.path = null\r\n\t\t\tthis.image.url = null\r\n\t\t\tthis.image.crop = null\r\n\t\t\tthis.image.license = null\r\n\t\t\tthis.croppedImageUrl = null\r\n\t\t},\r\n\r\n\t\thandleError(error) {\r\n\t\t\tthis.uploading = false\r\n\t\t\tthis.loading = false\r\n\t\t\tthis.progress = 0\r\n\t\t\tthis.image.url = null\r\n\t\t\t// Clear the input so we can select the same image if needed.\r\n\t\t\tthis.$el.querySelector('input[type=\"file\"]').value = ''\r\n\r\n\t\t\tif (!error.response) {\r\n\t\t\t\treturn this.$buefy.toast.open({\r\n\t\t\t\t\tduration: 5000,\r\n\t\t\t\t\tmessage: error.message,\r\n\t\t\t\t\tposition: 'is-top',\r\n\t\t\t\t\ttype: 'is-danger'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tthis.error = error.response.data.errors.file[0] || this.trans('Error')\r\n\t\t},\r\n\r\n\t\topenCropModal() {\r\n\t\t\tthis.showCropModal = true\r\n\t\t},\r\n\r\n\t\tcloseCropModal() {\r\n\t\t\tthis.showCropModal = false\r\n\t\t},\r\n\r\n\t\tcropThumbnail(crop) {\r\n\t\t\t// Create image\r\n\t\t\tconst image = document.createElement('img')\r\n\t\t\timage.src = this.image.url\r\n\r\n\t\t\t// Draw canvas\r\n\t\t\tconst canvas = document.createElement('canvas')\r\n\r\n  \t\tcanvas.setAttribute('width', crop.width)\r\n  \t\tcanvas.setAttribute('height', crop.height)\r\n\r\n  \t\tconst context = canvas.getContext('2d')\r\n  \t\tcontext.drawImage(image, -crop.x, -crop.y)\r\n\r\n\t\t\tthis.croppedImageUrl = canvas.toDataURL()\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle license change.\r\n\t\t *\r\n\t\t * @param {String|Number} license\r\n\t\t */\r\n\t\thandleLicenseChanged(license) {\r\n\t\t\tthis.image.license = license\r\n\t\t\tthis.$emit('license-changed', license)\r\n    }\r\n\t}\r\n}\r\n</script>\r\n","import { render, staticRenderFns } from \"./ImageCropModal.vue?vue&type=template&id=035960ca&\"\nimport script from \"./ImageCropModal.vue?vue&type=script&lang=js&\"\nexport * from \"./ImageCropModal.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('transition',{attrs:{\"name\":_vm.animation}},[(_vm.isActive)?_c('div',{staticClass:\"modal is-active\"},[_c('div',{staticClass:\"modal-background\"}),_vm._v(\" \"),_c('div',{staticClass:\"animation-content modal-content\",style:({ maxWidth: _vm.newWidth })},[_c('img',{ref:\"cropModalImage\",staticClass:\"image\",attrs:{\"src\":_vm.imageUrl,\"alt\":\"Cropped image\"}})]),_vm._v(\" \"),_c('button',{staticClass:\"modal-close is-large\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){return _vm.cancel('x')}}}),_vm._v(\" \"),_c('button',{staticClass:\"modal-action\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.cropImage}},[_c('b-icon',{attrs:{\"icon\":\"check\"}})],1)]):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./PhotoUpload.vue?vue&type=template&id=58da6edb&\"\nimport script from \"./PhotoUpload.vue?vue&type=script&lang=js&\"\nexport * from \"./PhotoUpload.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('b-modal',{attrs:{\"active\":_vm.active,\"can-cancel\":['escape', 'x']},on:{\"update:active\":function($event){_vm.active=$event},\"close\":_vm.onClose}},[_c('div',{staticClass:\"image-modal\"},[_c('img',{attrs:{\"src\":_vm.openImage}}),_vm._v(\" \"),(_vm.items.length > 1)?_c('div',{staticClass:\"image-modal-navigation\"},[_c('div',{staticClass:\"image-modal-previous\",on:{\"click\":_vm.prev}},[_c('i',{staticClass:\"fa fa-chevron-left\",attrs:{\"aria-hidden\":\"true\"}})]),_vm._v(\" \"),_c('div',{staticClass:\"image-modal-next\",on:{\"click\":_vm.next}},[_c('i',{staticClass:\"fa fa-chevron-right\",attrs:{\"aria-hidden\":\"true\"}})])]):_vm._e()])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ImageModal.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ImageModal.vue?vue&type=script&lang=js&\"","<template>\r\n  <b-modal :active.sync=\"active\" :can-cancel=\"['escape', 'x']\" @close=\"onClose\">\r\n    <div class=\"image-modal\">\r\n      <img :src=\"openImage\">\r\n\r\n      <div class=\"image-modal-navigation\" v-if=\"items.length > 1\">\r\n        <div class=\"image-modal-previous\" @click=\"prev\">\r\n          <i class=\"fa fa-chevron-left\" aria-hidden=\"true\"></i>\r\n        </div>\r\n\r\n        <div class=\"image-modal-next\" @click=\"next\">\r\n          <i class=\"fa fa-chevron-right\" aria-hidden=\"true\"></i>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </b-modal>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'nzImageModal',\r\n\r\n  props: {\r\n    items: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    value: {\r\n      type: Number,\r\n      default: 0\r\n    }\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      newValue: this.value,\r\n      active: false\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    openImage() {\r\n      return this.items[this.newValue]\r\n    }\r\n  },\r\n\r\n  watch: {\r\n    newValue() {\r\n      this.$emit('input', this.newValue)\r\n    },\r\n\r\n    openImage: {\r\n      handler(value) {\r\n        this.active = Boolean(value)\r\n      }\r\n    }\r\n  },\r\n\r\n  created() {\r\n    document.addEventListener('keyup', this.registerKeyListener)\r\n  },\r\n\r\n  mounted() {\r\n    this.active = Boolean(this.openImage)\r\n  },\r\n\r\n  beforeDestroy() {\r\n    document.removeEventListener('keyup', this.registerKeyListener)\r\n  },\r\n\r\n  methods: {\r\n    next() {\r\n      let newValue = this.newValue + 1\r\n\r\n      if (newValue >= this.items.length) {\r\n        newValue = 0\r\n      }\r\n\r\n      this.newValue = newValue\r\n    },\r\n\r\n    prev() {\r\n      let newValue = this.newValue - 1\r\n\r\n      if (newValue < 0) {\r\n        newValue = this.items.length - 1\r\n      }\r\n\r\n      this.newValue = newValue\r\n    },\r\n\r\n    registerKeyListener(e) {\r\n      const key = e.which || e.keyCode\r\n\r\n      if (key === 37) { // left arrow\r\n        this.prev()\r\n      } else if (key === 39) { // right arrow\r\n        this.next()\r\n      }\r\n    },\r\n\r\n    onClose(e) {\r\n      this.active = false\r\n\r\n      // b-modal component adds classes that prevent scrolling on body when active\r\n      // so we need to wait for it to remove them before we signal it's closing\r\n      this.$nextTick(() => {\r\n        this.$emit('close', e)\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import { render, staticRenderFns } from \"./ImageModal.vue?vue&type=template&id=0d20be8b&\"\nimport script from \"./ImageModal.vue?vue&type=script&lang=js&\"\nexport * from \"./ImageModal.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('form',{attrs:{\"action\":_vm.action,\"method\":\"POST\"},on:{\"submit\":function($event){$event.preventDefault();return _vm.submitWithRedirect($event)}}},[_c('b-field',{attrs:{\"label\":_vm.trans('labels.view_groups.parent')}},[_c('b-select',{model:{value:(_vm.parent),callback:function ($$v) {_vm.parent=$$v},expression:\"parent\"}},[_c('option'),_vm._v(\" \"),_vm._l((_vm.rootGroups),function(rootGroup){return _c('option',{domProps:{\"value\":rootGroup}},[_vm._v(_vm._s(rootGroup.name))])})],2)],1),_vm._v(\" \"),_c('b-field',{attrs:{\"label\":_vm.trans('labels.view_groups.name')}},[_c('b-tabs',{staticClass:\"block\",attrs:{\"size\":\"is-small\"},on:{\"change\":function (index) { return _vm.focusOnTranslation(index, 'name'); }}},_vm._l((_vm.supportedLocales),function(data,locale){return _c('b-tab-item',{key:locale,attrs:{\"label\":_vm.trans('languages.' + data.name)}},[_c('b-input',{attrs:{\"id\":(\"name-\" + locale)},model:{value:(_vm.form.name[locale]),callback:function ($$v) {_vm.$set(_vm.form.name, locale, $$v)},expression:\"form.name[locale]\"}})],1)}),1)],1),_vm._v(\" \"),_c('b-field',{attrs:{\"label\":_vm.trans('labels.view_groups.description')}},[_c('b-tabs',{staticClass:\"block\",attrs:{\"size\":\"is-small\"},on:{\"change\":function (index) { return _vm.focusOnTranslation(index, 'description'); }}},_vm._l((_vm.supportedLocales),function(data,locale){return _c('b-tab-item',{key:locale,attrs:{\"label\":_vm.trans('languages.' + data.name)}},[_c('b-input',{attrs:{\"type\":\"textarea\",\"id\":(\"description-\" + locale)},model:{value:(_vm.form.description[locale]),callback:function ($$v) {_vm.$set(_vm.form.description, locale, $$v)},expression:\"form.description[locale]\"}})],1)}),1)],1),_vm._v(\" \"),(!_vm.isRoot)?[_c('b-field',{attrs:{\"label\":_vm.trans('labels.view_groups.taxa')}},[_c('b-taginput',{attrs:{\"data\":_vm.filteredTaxa,\"autocomplete\":\"\",\"field\":\"name\"},on:{\"typing\":_vm.onTaxonNameInput},scopedSlots:_vm._u([{key:\"default\",fn:function(props){return [_c('span',[_vm._v(_vm._s(props.option.name))])]}}],null,false,1538493864),model:{value:(_vm.taxa),callback:function ($$v) {_vm.taxa=$$v},expression:\"taxa\"}})],1),_vm._v(\" \"),_c('b-field',[_c('b-checkbox',{model:{value:(_vm.form.only_observed_taxa),callback:function ($$v) {_vm.$set(_vm.form, \"only_observed_taxa\", $$v)},expression:\"form.only_observed_taxa\"}},[_vm._v(_vm._s(_vm.trans('labels.view_groups.only_observed_taxa')))])],1)]:_vm._e(),_vm._v(\" \"),_c('b-field',{attrs:{\"label\":_vm.trans('labels.view_groups.image')}},[_c('nz-photo-upload',{attrs:{\"image-url\":_vm.form.image_url,\"image-path\":_vm.form.image_path,\"licenses\":{},\"with-license\":false,\"with-crop\":false},on:{\"uploaded\":_vm.onImageUploaded,\"removed\":_vm.onImageRemoved}})],1),_vm._v(\" \"),_c('hr'),_vm._v(\" \"),_c('button',{staticClass:\"button is-primary\",class:{\n        'is-loading': _vm.form.processing\n    },attrs:{\"type\":\"submit\"},on:{\"click\":_vm.submitWithRedirect}},[_vm._v(\"\\n    \"+_vm._s(_vm.trans('buttons.save'))+\"\\n  \")]),_vm._v(\" \"),_c('a',{staticClass:\"button is-text\",attrs:{\"href\":_vm.cancelUrl},on:{\"click\":_vm.onCancel}},[_vm._v(_vm._s(_vm.trans('buttons.cancel')))])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <form :action=\"action\" method=\"POST\" @submit.prevent=\"submitWithRedirect\">\r\n    <b-field :label=\"trans('labels.view_groups.parent')\">\r\n      <b-select v-model=\"parent\">\r\n        <option></option>\r\n        <option v-for=\"rootGroup in rootGroups\" :value=\"rootGroup\">{{ rootGroup.name }}</option>\r\n      </b-select>\r\n    </b-field>\r\n\r\n    <b-field :label=\"trans('labels.view_groups.name')\">\r\n      <b-tabs size=\"is-small\" class=\"block\" @change=\"(index) => focusOnTranslation(index, 'name')\">\r\n        <b-tab-item :label=\"trans('languages.' + data.name)\" v-for=\"(data, locale) in supportedLocales\" :key=\"locale\">\r\n          <b-input v-model=\"form.name[locale]\" :id=\"`name-${locale}`\" />\r\n        </b-tab-item>\r\n      </b-tabs>\r\n    </b-field>\r\n\r\n    <b-field :label=\"trans('labels.view_groups.description')\">\r\n      <b-tabs size=\"is-small\" class=\"block\" @change=\"(index) => focusOnTranslation(index, 'description')\">\r\n        <b-tab-item :label=\"trans('languages.' + data.name)\" v-for=\"(data, locale) in supportedLocales\" :key=\"locale\">\r\n          <b-input type=\"textarea\" v-model=\"form.description[locale]\" :id=\"`description-${locale}`\" />\r\n        </b-tab-item>\r\n      </b-tabs>\r\n    </b-field>\r\n\r\n    <template v-if=\"!isRoot\">\r\n      <b-field :label=\"trans('labels.view_groups.taxa')\">\r\n        <b-taginput v-model=\"taxa\"\r\n            :data=\"filteredTaxa\"\r\n            autocomplete\r\n            field=\"name\"\r\n            @typing=\"onTaxonNameInput\"\r\n        >\r\n          <template v-slot:default=\"props\">\r\n            <span>{{ props.option.name }}</span>\r\n          </template>\r\n        </b-taginput>\r\n      </b-field>\r\n\r\n      <b-field>\r\n        <b-checkbox v-model=\"form.only_observed_taxa\">{{ trans('labels.view_groups.only_observed_taxa') }}</b-checkbox>\r\n      </b-field>\r\n    </template>\r\n\r\n    <b-field :label=\"trans('labels.view_groups.image')\">\r\n      <nz-photo-upload\r\n        :image-url=\"form.image_url\"\r\n    \t\t:image-path=\"form.image_path\"\r\n    \t\t:licenses=\"{}\"\r\n    \t\t:with-license=\"false\"\r\n        :with-crop=\"false\"\r\n        @uploaded=\"onImageUploaded\"\r\n        @removed=\"onImageRemoved\"\r\n      />\r\n    </b-field>\r\n\r\n    <hr>\r\n\r\n    <button\r\n      type=\"submit\"\r\n      class=\"button is-primary\"\r\n      :class=\"{\r\n          'is-loading': form.processing\r\n      }\"\r\n      @click=\"submitWithRedirect\"\r\n    >\r\n      {{ trans('buttons.save') }}\r\n    </button>\r\n\r\n    <a :href=\"cancelUrl\" class=\"button is-text\" @click=\"onCancel\">{{ trans('buttons.cancel') }}</a>\r\n  </form>\r\n</template>\r\n\r\n<script>\r\nimport Form from 'form-backend-validation'\r\nimport _keys from 'lodash/keys'\r\nimport _find from 'lodash/find'\r\nimport _get from 'lodash/get'\r\nimport _debounce from 'lodash/debounce'\r\nimport FormMixin from '@/mixins/FormMixin'\r\nimport NzPhotoUpload from '@/components/inputs/PhotoUpload'\r\n\r\nfunction defaultTranslations() {\r\n  const value = {}\r\n\r\n  _keys(window.App.supportedLocales).forEach(locale => {\r\n    value[locale] = null\r\n  })\r\n\r\n  return value\r\n}\r\n\r\nexport default {\r\n  name: 'nzViewGroupForm',\r\n\r\n  mixins: [FormMixin],\r\n\r\n  components: {\r\n    NzPhotoUpload\r\n  },\r\n\r\n  props: {\r\n    group: {\r\n      type: Object,\r\n      default() {\r\n        return {\r\n            parent_id: null,\r\n            only_observed_taxa: false,\r\n            taxa: []\r\n        }\r\n      }\r\n    },\r\n    rootGroups: Array,\r\n    names: {\r\n      type: Object,\r\n      default: () => defaultTranslations()\r\n    },\r\n    descriptions: {\r\n      type: Object,\r\n      default: () => defaultTranslations()\r\n    }\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      form: this.newForm(),\r\n      taxa: this.group.taxa,\r\n      filteredTaxa: []\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    supportedLocales() {\r\n      return window.App.supportedLocales\r\n    },\r\n\r\n    parent: {\r\n      get() {\r\n        return _find(this.rootGroups, { id: this.form.parent_id })\r\n      },\r\n\r\n      set(value) {\r\n        this.form.parent_id = _get(value, 'id')\r\n      }\r\n    },\r\n\r\n    isRoot() {\r\n      return !this.form.parent_id\r\n    }\r\n  },\r\n\r\n  watch: {\r\n    taxa(value) {\r\n      this.form.taxa_ids = value.map(taxon => taxon.id)\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    newForm() {\r\n      return new Form({\r\n        parent_id: this.group.parent_id,\r\n        name: this.names,\r\n        description: this.descriptions,\r\n        image_url: this.group.image_url,\r\n        image_path: this.group.image_path,\r\n        only_observed_taxa: this.group.only_observed_taxa,\r\n        taxa_ids: this.group.taxa.map(taxon => taxon.id)\r\n      }, {\r\n        resetOnSuccess: false\r\n      })\r\n    },\r\n\r\n    focusOnTranslation(index, attribute) {\r\n      const locales = _keys(this.supportedLocales)\r\n      const selector = `#${attribute}-${locales[index]}`\r\n\r\n      setTimeout(() => {\r\n        this.$el.querySelector(selector).focus()\r\n      }, 500)\r\n    },\r\n\r\n    fetchTaxa(name) {\r\n      axios.get(route('api.taxa.index'), {\r\n        params: {\r\n          name,\r\n          page: 1,\r\n          per_page: 10,\r\n          except: this.taxa.map(taxon => taxon.id)\r\n        }\r\n      }).then(({ data }) => {\r\n        this.filteredTaxa = data.data\r\n      })\r\n    },\r\n\r\n    onTaxonNameInput: _debounce(function (name) {\r\n      return this.fetchTaxa(name)\r\n    }, 500),\r\n\r\n    onImageUploaded(image) {\r\n      this.form.image_path = image.path\r\n    },\r\n\r\n    onImageRemoved() {\r\n      this.form.image_url = null\r\n      this.form.image_path = null\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ViewGroupForm.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ViewGroupForm.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ViewGroupForm.vue?vue&type=template&id=ed2cecba&\"\nimport script from \"./ViewGroupForm.vue?vue&type=script&lang=js&\"\nexport * from \"./ViewGroupForm.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}